<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sorting Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
    }

    h1 {
      margin-bottom: 10px;
    }

    .form-row {
      margin-bottom: 10px;
    }

    label {
      margin-right: 8px;
      font-weight: bold;
    }

    input[type="text"] {
      padding: 4px 6px;
      margin-right: 8px;
      width: 160px;
      box-sizing: border-box;
    }

    input[readonly] {
      background-color: #f0f0f0;
      cursor: default;
    }

    button {
      padding: 5px 12px;
      cursor: pointer;
    }

    .sort-section {
      margin: 20px 0 10px;
    }

    .sort-controls {
      display: inline-flex;
      align-items: center;
      border: 1px solid #999;
      padding: 4px 6px;
      border-radius: 4px;
    }

    .sort-controls select {
      border: none;
      outline: none;
      background: transparent;
      margin-right: 4px;
    }

    .sort-direction {
      border: none;
      background: none;
      cursor: pointer;
      font-size: 14px;
      padding: 0 4px;
    }

    table {
      border-collapse: collapse;
      margin-top: 10px;
      min-width: 460px;
    }

    th, td {
      border: 1px solid #999;
      padding: 6px 10px;
      text-align: left;
    }

    th {
      background-color: #f5f5f5;
    }

    .no-data {
      margin-top: 10px;
      font-style: italic;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>Sorting Test</h1>

  <!-- Input section -->
  <div class="form-row">
    <label for="userId">UserID</label>
    <input type="text" id="userId" readonly />
    <input type="text" id="userName" placeholder="UserName" />
    <input type="text" id="userOccupation" placeholder="UserOccupation" />
    <button id="addUserBtn">Add</button>
  </div>

  <!-- Sort controls -->
  <div class="sort-section">
    Sort by:
    <span class="sort-controls">
      <select id="sortField">
        <option value="id">UserID</option>
        <option value="name">UserName</option>
        <option value="occupation">UserOccupation</option>
      </select>
      <button id="sortDirectionBtn" class="sort-direction" title="Toggle ascending/descending">
        ▲
      </button>
    </span>
  </div>

  <!-- Table -->
  <table id="userTable">
    <thead>
      <tr>
        <th>UserID</th>
        <th>UserName</th>
        <th>UserOccupation</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows will be injected here -->
    </tbody>
  </table>

  <div id="noDataMsg" class="no-data">No users yet. Add one above.</div>

  <script>
    // Simple data model: array of user object
    const STORAGE_KEY = "sortingTestUsers";

    let users = [];
    let nextId = 1;

    // Current sort settings
    let sortField = "id";         
    let sortAscending = true;    

    // DOM references
    const userIdInput = document.getElementById("userId");
    const userNameInput = document.getElementById("userName");
    const userOccupationInput = document.getElementById("userOccupation");
    const addUserBtn = document.getElementById("addUserBtn");
    const sortFieldSelect = document.getElementById("sortField");
    const sortDirectionBtn = document.getElementById("sortDirectionBtn");
    const userTableBody = document.querySelector("#userTable tbody");
    const noDataMsg = document.getElementById("noDataMsg");

    // page load
    window.addEventListener("DOMContentLoaded", () => {
      loadFromStorage();
      updateUserIdTextbox();
      renderTable();
    });

    addUserBtn.addEventListener("click", () => {
      const name = userNameInput.value.trim();
      const occupation = userOccupationInput.value.trim();

      if (!name || !occupation) {
        alert("Please enter both UserName and UserOccupation.");
        return;
      }

      const newUser = {
        id: nextId,
        name: name,
        occupation: occupation
      };

      users.push(newUser);
      nextId++;

      saveToStorage();
      updateUserIdTextbox();
      clearInputFields();
      renderTable();
    });

    // Sort field
    sortFieldSelect.addEventListener("change", () => {
      sortField = sortFieldSelect.value;
      renderTable();
    });

    // Toggle direction
    sortDirectionBtn.addEventListener("click", () => {
      sortAscending = !sortAscending;
      sortDirectionBtn.textContent = sortAscending ? "▲" : "▼";
      renderTable();
    });


    function updateUserIdTextbox() {
      userIdInput.value = nextId;
    }

    function clearInputFields() {
      userNameInput.value = "";
      userOccupationInput.value = "";
      userNameInput.focus();
    }

    function renderTable() {
      userTableBody.innerHTML = "";

      if (users.length === 0) {
        noDataMsg.style.display = "block";
        return;
      } else {
        noDataMsg.style.display = "none";
      }

      const sortedUsers = users.slice().sort(compareUsers);

      // Rows
      for (const u of sortedUsers) {
        const tr = document.createElement("tr");

        const tdId = document.createElement("td");
        tdId.textContent = u.id;

        const tdName = document.createElement("td");
        tdName.textContent = u.name;

        const tdOcc = document.createElement("td");
        tdOcc.textContent = u.occupation;

        tr.appendChild(tdId);
        tr.appendChild(tdName);
        tr.appendChild(tdOcc);
        userTableBody.appendChild(tr);
      }
    }

    function compareUsers(a, b) {
      let comparison = 0;

      if (sortField === "id") {
        // numeric comparison
        comparison = a.id - b.id;
      } else if (sortField === "name") {
        comparison = a.name.localeCompare(b.name);
      } else if (sortField === "occupation") {
        comparison = a.occupation.localeCompare(b.occupation);
      }

      return sortAscending ? comparison : -comparison;
    }

    function saveToStorage() {
      const data = {
        users: users,
        nextId: nextId
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function loadFromStorage() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;

        const data = JSON.parse(raw);
        if (Array.isArray(data.users)) {
          users = data.users;
        }
        if (typeof data.nextId === "number" && data.nextId > 0) {
          nextId = data.nextId;
        } else {
          const maxId = users.reduce((max, u) => Math.max(max, u.id), 0);
          nextId = maxId + 1;
        }
      } catch (e) {
        console.error("Failed to load from storage", e);
      }
    }
  </script>
</body>
</html>

